enum LendingAdapterType {
    MORPHO
    OTHER
}

type LeverageManager @entity(immutable: true) {
    " Address of the LeverageManager "
    id: Bytes!
    " Admin address of the LeverageManager "
    admin: Bytes!
    " Fee manager role address of the LeverageManager "
    feeManagerRole: Bytes!
    " Treasury address of the LeverageManager "
    treasury: Bytes!
    " LeverageToken factory address of the LeverageManager "
    leverageTokenFactory: Bytes!
    " All LeverageTokens managed by this LeverageManager "
    leverageTokens: [LeverageToken!]!
    " Total number of LeverageTokens managed by this LeverageManager "
    totalLeverageTokens: BigInt!
    " Total collateral across all LeverageTokens managed by this LeverageManager "
    totalCollateral: BigInt!
    " Total collateral price in USD across all LeverageTokens managed by this LeverageManager "
    totalCollateralUSD: BigDecimal!
    " Total debt across all LeverageTokens managed by this LeverageManager "
    totalDebt: BigInt!
    " Total debt price in USD across all LeverageTokens managed by this LeverageManager "
    totalDebtUSD: BigDecimal!
    " Total number of unique LeverageToken holders across all LeverageTokens managed by this LeverageManager "
    totalHolders: BigInt!
}


type LeverageToken @entity(immutable: true) {
    # ===============================
    # ======== Configuration ========
    # ===============================

    " Address of the LeverageToken "
    id: Bytes!
    " Name of the LeverageToken "
    name: String!
    " Symbol of the LeverageToken "
    symbol: String!
    " The LendingAdapter used by this LeverageToken "
    lendingAdapter: LendingAdapter!
    " The RebalanceAdapter used by this LeverageToken "
    rebalanceAdapter: Bytes!

    # ======================
    # ======== Fees ========
    # ======================

    " Management fee for this LeverageToken "
    managementFee: BigInt!
    " Mint treasury action fee for this LeverageToken "
    mintTreasuryActionFee: BigInt!
    " Redeem treasury action fee for this LeverageToken "
    redeemTreasuryActionFee: BigInt!
    " Mint token action fee for this LeverageToken "
    mintTokenActionFee: BigInt!
    " Redeem token action fee for this LeverageToken "
    redeemTokenActionFee: BigInt!

    # # ============================================
    # # ======== Leverage Position Balances ========
    # # ============================================

    # " All positions in this LeverageToken "
    # positions: [Position!]! @derivedFrom(field: "leverageToken")
    " Current total collateral across all positions "
    totalCollateral: BigInt!
    " Current total collateral price in USD "
    totalCollateralUSD: BigDecimal!
    " Current total debt across all positions "
    totalDebt: BigInt!
    " Current total debt price in USD "
    totalDebtUSD: BigDecimal!

    # # Do we need both?
    " Current total equity in collateral asset "
    totalEquityInCollateral: BigInt!
    " Current total equity in debt asset "
    totalEquityInDebt: BigInt!

    " Current total equity price in USD "
    totalEquityUSD: BigDecimal!
    " Total supply of the LeverageToken "
    totalSupply: BigInt!
    " Total number of unique LeverageToken holders "
    totalHolders: BigInt!

    # # =============================
    # # ======== Fees Earned ========
    # # =============================

    " Total mint token action fees earned "
    totalMintTokenActionFees: BigInt!
    " Total mint token action fees earned in USD "
    totalMintTokenActionFeesUSD: BigDecimal!
    " Total redeem token action fees earned "
    totalRedeemTokenActionFees: BigInt!
    " Total redeem token action fees earned in USD "
    totalRedeemTokenActionFeesUSD: BigDecimal!
    " Total mint treasury fees earned in shares "
    totalMintTreasuryFees: BigInt!
    " Total mint treasury fees earned in USD "
    totalMintTreasuryFeesUSD: BigDecimal!
    " Total redeem treasury fees earned in shares "
    totalRedeemTreasuryFees: BigInt!
    " Total redeem treasury fees earned in USD "
    totalRedeemTreasuryFeesUSD: BigDecimal!
    " Total management fees earned in shares "
    totalManagementFees: BigInt!
    " Total management fees earned in USD "
    totalManagementFeesUSD: BigDecimal!

    # # =================================
    # # ======== Historical Data ========
    # # =================================

    # " Historical collateral updates "
    # collateralUpdates: [CollateralUpdate!]! @derivedFrom(field: "leverageToken")
    # " Historical debt updates "
    # debtUpdates: [DebtUpdate!]! @derivedFrom(field: "leverageToken")
    # " Historical mint events "
    # mints: [Mint!]! @derivedFrom(field: "leverageToken")
    # " Historical redeem events "
    # redeems: [Redeem!]! @derivedFrom(field: "leverageToken")
    # " Historical rebalances "
    # rebalances: [Rebalance!]! @derivedFrom(field: "leverageToken")

    # # =====================================
    # # ======== Additional Metadata ========
    # # =====================================

    " Creation timestamp "
    createdTimestamp: BigInt!
    " Creation block number "
    createdBlockNumber: BigInt!
}

type LendingAdapter @entity(immutable: true) {
    " Address of the LendingAdapter "
    id: Bytes!
    " Type of the LendingAdapter (e.g., MORPHO, OTHER) "
    type: LendingAdapterType!
    " Market ID of the LendingAdapter if type is MORPHO, null otherwise "
    morphoMarketId: Bytes
    " Address of the collateral asset "
    collateralAsset: Bytes!
    " Address of the debt asset "
    debtAsset: Bytes!
}


# ========================================
# ======== LeverageManager Events ========
# ========================================

type ManagementFeeCharged @entity(immutable: true) {
  id: Bytes!
  leverageToken: Bytes! # address
  sharesFee: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Mint @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  sender: Bytes! # address
  actionData_collateral: BigInt! # uint256
  actionData_debt: BigInt! # uint256
  actionData_equity: BigInt! # uint256
  actionData_shares: BigInt! # uint256
  actionData_tokenFee: BigInt! # uint256
  actionData_treasuryFee: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Rebalance @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  sender: Bytes! # address
  actions: [Bytes!]! # tuple[]
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Redeem @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  sender: Bytes! # address
  actionData_collateral: BigInt! # uint256
  actionData_debt: BigInt! # uint256
  actionData_equity: BigInt! # uint256
  actionData_shares: BigInt! # uint256
  actionData_tokenFee: BigInt! # uint256
  actionData_treasuryFee: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# =========================================
# ======== RebalanceAdapter Events ========
# =========================================

type AuctionCreated @entity(immutable: true) {
  id: Bytes!
  auction_isOverCollateralized: Boolean! # bool
  auction_startTimestamp: BigInt! # uint120
  auction_endTimestamp: BigInt! # uint120
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type AuctionEnded @entity(immutable: true) {
  id: Bytes!

  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Take @entity(immutable: true) {
  id: Bytes!
  taker: Bytes! # address
  amountIn: BigInt! # uint256
  amountOut: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# ===============================
# ======== Morpho Events ========
# ===============================

type Liquidate @entity(immutable: true) {
  id: Bytes!
  internal_id: Bytes! # bytes32
  caller: Bytes! # address
  borrower: Bytes! # address
  repaidAssets: BigInt! # uint256
  repaidShares: BigInt! # uint256
  seizedAssets: BigInt! # uint256
  badDebtAssets: BigInt! # uint256
  badDebtShares: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}